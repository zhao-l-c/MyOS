; ============================================
; 导出函数声明
; ============================================
global _io_hlt, _out8, _sti, _cli, _load_eflags, _store_eflags

; ============================================
; 导入函数声明
; ============================================

; ============================================
; 数据定义在此
; ============================================
[section .data]



; ============================================
; 主函数入口
; ============================================
[section .text]

; ============================================
; 辅助函数定义在此
; ============================================

; --------------------------------------------
; hlt函数
; --------------------------------------------
_io_hlt: 
    hlt
    ret

; --------------------------------------------
; _out8(int port, int data);
; 输出数据data端口port。
; --------------------------------------------
_out8:
    mov edx, [esp + 4] ; 获取输出端口
    mov al,  [esp + 8] ; 获取数据
    out dx, al
    ret


_cli:
    cli
    ret

_sti:
    sti
    ret

_load_eflags:
    pushfd
    pop eax
    ret

_store_eflags:
    mov eax, [esp + 4]
    push eax
    popfd
    ret
